<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="쉼표샵에서 만들어진 높은 퀄리티를 자랑하는 상품을 구매하세요.">
    <meta name="robots" content="max-image-preview:large">
    <title>쉼표샵 상품 | shmpyo#</title>
    <link href="./IMg/쉼표샵로고.png" rel="shortcut icon" type="image/x-icon">
    <link rel="canonical" href="https://shmpyoshop.netlify.app/">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:site_name" content="쉼표샵 shmpyo#">
    <meta property="og:type" content="website">
    <meta property="og:title" content="쉼표샵 상품 - 쉼표샵 공식 홈페이지">
    <meta property="og:description" content="쉼표샵에서 만들어진 높은 퀄리티를 자랑하는 상품을 구매하세요.">
    <meta property="og:url" content="https://shmpyoshop.netlify.app/">
    <meta property="og:image" content="https://media.discordapp.net/attachments/1193969295881933010/1284363066175131701/660510020f1c7f4d.png?ex=66e65bd1&is=66e50a51&hm=e3ae295b17cdcd2a3a707a1c37cb568b5f9308580cfa8d37a639a2c43e2fc61a&=&format=webp&quality=lossless">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="쉼표샵 로고">    

    <meta name="twitter:site" content="https://shmpyoshop.netlify.app/">
    <meta name="twitter:title" content="쉼표샵 상품 - 쉼표샵 공식 홈페이지">
    <meta name="twitter:description" content="쉼표샵에서 만들어진 높은 퀄리티를 자랑하는 상품을 구매하세요.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:src" content="https://media.discordapp.net/attachments/1193969295881933010/1284363066175131701/660510020f1c7f4d.png?ex=66e65bd1&is=66e50a51&hm=e3ae295b17cdcd2a3a707a1c37cb568b5f9308580cfa8d37a639a2c43e2fc61a&=&format=webp&quality=lossless">
    <link rel="stylesheet" href="/project/payment/shmpyo_product_payment.css"/>
    <script src="https://js.tosspayments.com/v2/standard"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <header class="header" id="header">
        <a href="/home" class="logo">shmpyo</a>
        <nav class='navbar'>
            <a href="/home">홈</a>
            <a href="/project/service-terms">이용규정</a>
            <a href="https://smartstore.naver.com/shmpyo" target="_blank">전체상품</a>
            <a href="/project/add/goods-code">비밀코드 활성화</a>
        </nav>
    </header>

    <div class="info_1_section">
        <div class="find_item">
            <h1 class="ifo_title_h1">결제를 시작할게요</h1>
            <div class="flex">

                <div class="section_one">
                    <div class="product_infomation">
                        <div class="product_infomation_main_title">상품 정보</div>
                        <div class="flex">
                            <img class="product_image" src="/IMG/product_img/SP3019.png">
                            <div>
                                <div class="product_title">공지시스템Pro</div>
                                <div class="product_sub_title">비밀코드 1개</div>
                                <div class="product_price"></div>
                            </div>
                        </div>
                    </div>
    
                    <div class="product_order_infomation">
                        <div class="product_order_infomation_main_title">주문자 정보</div>
                        <div class="flex_input">
                            <p class="sub_title" id="one_title"><span class="required">*</span>이름</p>
                            <div class="error" id="error-message-name" style="color: #D58181;"></div>
                        </div>
                        <input type="text" id="name" class="input_one_section">
                        
                        <div class="flex_input">
                            <p class="sub_title" id="one_title"><span class="required">*</span>전화번호</p>
                            <div class="error" id="error-message-phone" style="color: #D58181;"></div>
                        </div>
                        <input type="text" id="phone" class="input_one_section">
    
                        <div class="flex_input">
                            <p class="sub_title" id="one_title"><span class="required">*</span>로블록스 닉네임</p>
                            <div class="error" id="error-message-roblox" style="color: #D58181;"></div>
                        </div>
                        <input type="text" id="robloxName" class="input_one_section">
                    </div>

                    <div class="product_all_price_infomation">
                        <div class="product_all_price_infomation_price_section">
                            <div class="product_all_price_infomation_main_title">결제 방법</div>
                            <div id="payment-method"></div>
                        </div>
                    </div>
    
                    <div class="product_coupon">
                        <div class="product_coupon_main_title">쿠폰 적용</div>
                        <p class="sub_title">쿠폰 번호</p>
                        <div class="secretcode_input">
                            <input type="text" id="secretCode" class="input_two_section">
                            <button class="verify_button" id="check_secret_code">확인</button>
                        </div>
                        <div class="error" id="error-message" style="color: #D58181;"></div>
                    </div>
                </div>
    
                <div class="section_two">
                    <div class="product_price_infomation">
                        <div class="pproduct_price_infomation_main_title">결제 금액</div>
                        <div class="product_price_infomation_price_section">
                            <div class="product_price_sub_title">상품 가격</div>
                            <div class="product_price_sub_price"></div>
                        </div>
                        <div class="product_price_infomation_price_section">
                            <div class="product_price_sub_title">쿠폰 할인</div>
                            <div class="product_price_sub_price">0원</div>
                        </div>

                        <div class="line"></div>
    
                        <div class="product_price_infomation_price_section">
                            <div class="product_but_title">총 결제 금액</div>
                            <div class="product_but_price"></div>
                        </div>

                        <div id="agreement"></div>

                        <div class="lastbutton" id="lastbutton">
                            <button class="input_button_section" id="registerBtn">구매하기</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <iframe 
        src="/footer.html" 
        style="width: 100%; height: 250px; border: none;">
    </iframe>


    <script>
        let productId;
        let all_price;

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            
            const code = urlParams.get('code');
            const name = urlParams.get('name');
            productId = code
            const price = urlParams.get('price');
            all_price = Number(price)

            const formattedPrice = parseInt(price).toLocaleString() + '원';

            document.getElementsByClassName("product_price")[0].textContent = formattedPrice;
            document.getElementsByClassName("product_price_sub_price")[0].textContent = formattedPrice;
            document.getElementsByClassName("product_but_price")[0].textContent = formattedPrice;

            document.querySelector('.product_title').textContent = name;
            const imageUrl = `/IMG/product_img/${code}.png`; // 이미지 경로를 올바르게 설정
            document.querySelector('.product_image').src = imageUrl;
        }


        // axios.get(`http://127.0.0.1:3019/product/${productId}`)
        //     .then(response => {
        //         const productPrice = response.data.price;
        //         console.log("Fetched product price:", productPrice);
        //         all_price = productPrice;

        //         const formattedPrice = parseInt(productPrice).toLocaleString() + '원';

        //         document.getElementsByClassName("product_price_sub_price")[0].textContent = formattedPrice;
        //         document.getElementsByClassName("product_but_price")[0].textContent = formattedPrice;
        //         document.getElementsByClassName("product_price")[0].textContent = formattedPrice;
        //     })
        //     .catch(error => {
        //         console.error("Error fetching product:", error);
        //     });



        setTimeout(() => {
            main();
            async function main() {
            const button = document.getElementById("registerBtn");
            const clientKey = "test_gck_AQ92ymxN34Yz5ZmNN71KVajRKXvd"; // test client key
            const tossPayments = TossPayments(clientKey);
            const customerKey = "YQ5hsoCQ7zJXcBzFjneEW";
            const widgets = tossPayments.widgets({
                customerKey,
            });
        
            await widgets.setAmount({
                currency: "KRW",
                value: all_price,
            });
        
            await Promise.all([
                widgets.renderPaymentMethods({
                selector: "#payment-method",
                variantKey: "DEFAULT",
                }),
                widgets.renderAgreement({ selector: "#agreement", variantKey: "AGREEMENT" }),
            ]);
        
            button.addEventListener("click", async function () {
                const orderId = "unique_order_id_" + Date.now();  // 서버에서 받은 고유한 주문 ID로 교체해야 함
                const orderName = document.querySelector(".product_title").textContent;
        
                const customerName = document.getElementById("name").value.trim();
                const customerMobilePhone = document.getElementById("phone").value.trim();
        
                if (!customerName) {
                document.getElementById('error-message-name').textContent = '이름을 입력하세요';
                return;
                } else {
                    document.getElementById('error-message-name').textContent = '';
                }

                if (!customerMobilePhone) {
                document.getElementById('error-message-phone').textContent = '전화번호를 입력하세요';
                return;
                } else {
                    document.getElementById('error-message-phone').textContent = '';
                }

                const phonePattern = /^\d{10,11}$/;
                if (!phonePattern.test(customerMobilePhone)) {
                    document.getElementById('error-message-phone').textContent = '전화번호 형식을 다시 한번 확인해 주세요';
                    return;
                } else {
                    document.getElementById('error-message-phone').textContent = '';
                }

                if (!document.getElementById("robloxName").value.trim()) {
                document.getElementById('error-message-roblox').textContent = '로블록스 닉네임을 입력하세요';
                return;
                } else {
                    document.getElementById('error-message-roblox').textContent = '';
                }
        
                await widgets.requestPayment({
                orderId: orderId,
                orderName: orderName,
                successUrl: window.location.origin + "/success.html",
                failUrl: window.location.origin + "/fail.html",
                customerName: customerName,
                customerMobilePhone: customerMobilePhone,
                });
            });
            }
        }, 500);
        
      </script>
      
</body>
</html>
